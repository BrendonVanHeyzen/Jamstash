angular.module("JamStash",["ngCookies","ngRoute","ngSanitize","jamstash.subsonic.ctrl","jamstash.archive.ctrl"]).config(["$routeProvider",function(a){"use strict";a.when("/index",{redirectTo:"/library"}).when("/settings",{templateUrl:"settings/settings.html",controller:"SettingsCtrl"}).when("/queue",{templateUrl:"queue/queue.html",controller:"QueueCtrl"}).when("/library",{templateUrl:"subsonic/subsonic.html",controller:"SubsonicCtrl"}).when("/library/:artistId",{templateUrl:"subsonic/subsonic.html",controller:"SubsonicCtrl",reloadOnSearch:!1}).when("/library/:artistId/:albumId",{templateUrl:"subsonic/subsonic.html",controller:"SubsonicCtrl",reloadOnSearch:!1}).when("/podcasts",{templateUrl:"podcasts/podcasts.html",controller:"PodcastCtrl"}).when("/archive",{templateUrl:"archive/archive.html",controller:"ArchiveCtrl"}).when("/archive/:artist",{templateUrl:"archive/archive.html",controller:"ArchiveCtrl"}).when("/archive/:artist/:album",{templateUrl:"archive/archive.html",controller:"ArchiveCtrl"}).otherwise({redirectTo:"/index"})}]).config(["$httpProvider",function(a){"use strict";a.interceptors.push(["$rootScope","$location","$q","globals",function(a,b,c,d){return{request:function(c){a.loggedIn=!1,""!=d.settings.Username&&""!=d.settings.Password&&""!=d.settings.Server&&(a.loggedIn=!0);var e="";return e=b.path(),d.settings.Debug&&console.log("Logged In: "+a.loggedIn),d.settings.Debug&&console.log("Current Path: "+e),!a.loggedIn&&"/settings"!=e&&e.search("archive")<0&&b.path("/settings"),c},responseError:function(d){return 401===d.status&&"/settings"!=b.path()&&(a.loggedIn=!1,b.path("/settings")),c.reject(d)}}}])}]),angular.module("jamstash.settings",[]).service("globals",function(){"use strict";this.SearchTypes=[{id:"song",name:"Song"},{id:"album",name:"Album"},{id:"artist",name:"Artist"}],this.Layouts=[{id:"grid",name:"Grid"},{id:"list",name:"List"}],this.AlbumSorts=[{id:"default",name:"Default Sort"},{id:"artist",name:"Artist"},{id:"album",name:"Album"},{id:"track",name:"Track"},{id:"createdate desc",name:"Date Added"}],this.settings={Url:"http://jamstash.com/#/archive/",Username:"",Password:"",Server:"",Timeout:2e4,Protocol:"jsonp",ApplicationName:"Jamstash",ApiVersion:"1.6.0",AutoPlaylists:"",AutoPlaylistSize:25,AutoAlbumSize:15,HideAZ:!1,ScrollTitle:!0,NotificationSong:!0,NotificationNowPlaying:!1,SaveTrackPosition:!1,ForceFlash:!1,Theme:"Default",DefaultLibraryLayout:this.Layouts[0],DefaultSearchType:this.SearchTypes[0],DefaultAlbumSort:this.AlbumSorts[0],DefaultArchiveAlbumSort:"date desc",Jukebox:!1,AutoPlay:!1,LoopQueue:!1,Repeat:!1,Debug:!1,ShowQueue:!0},this.SavedCollections=[],this.SavedGenres=[],this.Player1="#playdeck_1",this.archiveUrl="https://archive.org/",this.ChangeLog=null,this.Messages=[],this.BaseURL=function(){return this.settings.Server+"/rest"},this.BaseParams=function(){return"u="+this.settings.Username+"&p="+this.settings.Password+"&f="+this.settings.Protocol+"&v="+this.settings.ApiVersion+"&c="+this.settings.ApplicationName}}).factory("json",["$http",function(a){"use strict";return{getCollections:function(b){a.get("archive/json_collections.json").success(b)},getChangeLog:function(b){a.get("common/json_changelog.json").success(b)}}}]),angular.module("jamstash.model",["jamstash.utils"]).service("model",["utils",function(a){"use strict";this.Index=function(a,b){this.name=a,this.artist=b},this.Artist=function(a,b){this.id=a,this.name=b},this.Album=function(a,b,c,d,e,f,g,h,i,j,k,l){this.id=a,this.parentid=b,this.name=c,this.artist=d,this.artistId=e,this.coverartthumb=f,this.coverartfull=g,this.date=h,this.starred=i,this.description=j,this.url=k,this.type=l},this.Song=function(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){this.id=b,this.parentid=c,this.track=d,this.name=e,this.artist=f,this.artistId=g,this.album=h,this.albumId=i,this.coverartthumb=j,this.coverartfull=k,this.duration=l,this.time=""===l?"00:00":a.secondsToTime(l),this.rating=m,this.starred=n,this.suffix=o,this.specs=p,this.url=q,this.position=r,this.selected=!1,this.playing=!1,this.description=s,this.displayName=this.name+" - "+this.album+" - "+this.artist}}]).service("map",["$http","globals","utils","model",function(a,b,c,d){"use strict";this.mapArtist=function(a){var b="",c=a.artist,e=[];return c.length>0?e=c:e[0]=c,angular.forEach(e,function(a){"undefined"!=typeof a.name&&(a.name=a.name.toString())}),"undefined"!=typeof a.name&&(b=a.name.toString()),new d.Index(b,e)},this.mapIndex=function(a){var b,c="";return"undefined"!=typeof a.id&&(c=a.id),"undefined"!=typeof a.name&&(b=a.name.toString()),new d.Artist(c,b)},this.mapAlbum=function(a){var c,e,f,g,h=a;"undefined"!=typeof h.coverArt&&(e=b.BaseURL()+"/getCoverArt.view?"+b.BaseParams()+"&size=160&id="+h.coverArt,f=b.BaseURL()+"/getCoverArt.view?"+b.BaseParams()+"&id="+h.coverArt),g="undefined"!=typeof h.starred?!0:!1,c="undefined"!=typeof h.title?h.title:h.name;var i;return i=h.isDir?"byfolder":"bytag",new d.Album(h.id,h.parent,c,h.artist.toString(),h.artistId,e,f,$.format.date(new Date(h.created),"yyyy-MM-dd h:mm a"),g,"","",i)},this.mapSong=function(a){var c,e,f,g,h,i,j,k=a,l="",m="",n="";"undefined"!=typeof k.coverArt?(m=b.BaseURL()+"/getCoverArt.view?"+b.BaseParams()+"&size=30&id="+k.coverArt,n=b.BaseURL()+"/getCoverArt.view?"+b.BaseParams()+"&id="+k.coverArt):(m="images/albumdefault_60.a457ae64.jpg",n="images/albumdefault_160.973dd405.jpg"),j="undefined"==typeof k.description?"":k.description,f="undefined"==typeof k.artist?"&nbsp;":k.artist.toString(),e="undefined"==typeof k.title?"&nbsp;":k.title.toString(),g="undefined"==typeof k.track?"&nbsp;":k.track.toString(),h="undefined"!=typeof k.starred?!0:!1,void 0!==k.bitRate&&(l+=k.bitRate+" Kbps"),l+=void 0!==k.transcodedSuffix?", transcoding:"+k.suffix+" > "+k.transcodedSuffix:", "+k.suffix,i=void 0!==k.transcodedSuffix?k.transcodedSuffix:k.suffix,"ogg"==i&&(i="oga");var o=Math.floor(1e5*Math.random());return c=b.BaseURL()+"/stream.view?"+b.BaseParams()+"&id="+k.id+"&salt="+o,new d.Song(k.id,k.parent,g,e,f,k.artistId,k.album,k.albumId,m,n,k.duration,k.userRating,h,i,l,c,0,j)},this.mapPlaylist=function(a){return new d.Artist(a.id,a.name)},this.mapPodcast=function(a){var c,e,f,g,h,i,j,k,l=a,m="",n="",o="";"undefined"!=typeof l.coverArt&&(n=b.BaseURL()+"/getCoverArt.view?"+b.BaseParams()+"&size=60&id="+l.coverArt,o=b.BaseURL()+"/getCoverArt.view?"+b.BaseParams()+"&id="+l.coverArt),j="undefined"==typeof l.album?"&nbsp;":l.album.toString(),i="undefined"==typeof l.artist?"&nbsp;":l.artist.toString(),k="undefined"==typeof l.title?"&nbsp;":l.title.toString(),h="undefined"==typeof l.description?"":l.description,e="undefined"==typeof l.track?"&nbsp;":l.track.toString(),f="undefined"!=typeof l.starred?!0:!1,void 0!==l.bitRate&&(m+=l.bitRate+" Kbps"),m+=void 0!==l.transcodedSuffix?", transcoding:"+l.suffix+" > "+l.transcodedSuffix:", "+l.suffix,g=void 0!==l.transcodedSuffix?l.transcodedSuffix:l.suffix,"ogg"==g&&(g="oga");var p=Math.floor(1e5*Math.random());return c=b.BaseURL()+"/stream.view?"+b.BaseParams()+"&id="+l.streamId+"&salt="+p,new d.Song(l.streamId,l.parent,e,k,i,l.artistId,j,l.albumId,n,o,l.duration,l.userRating,f,g,m,c,0,h)}}]),angular.module("jamstash.utils",["jamstash.settings"]).service("utils",["$rootScope","globals",function(a,b){"use strict";this.fancyboxOpenImage=function(a){$.fancybox.open({helpers:{overlay:{css:{background:"rgba(0, 0, 0, 0.15)"}}},hideOnContentClick:!0,type:"image",openEffect:"none",closeEffect:"none",href:a})},this.safeApply=function(b){var c=a.$root.$$phase;"$apply"===c||"$digest"===c?b&&"function"==typeof b&&b():this.$apply(b)},this.setValue=function(a,c){try{localStorage.setItem(a,JSON.stringify(c))}catch(d){b.settings.Debug&&console.log(d)}},this.getValue=function(a){try{var c=localStorage.getItem(a);return""!==c&&"undefined"!=typeof c?JSON.parse(c):!1}catch(d){b.settings.Debug&&console.log(d)}},this.sortDateFunction=function(a,b){return a.date<b.date?1:-1},this.sortArtistFunction=function(a,b){return a.artist.toLowerCase()<b.artist.toLowerCase()?-1:1},this.sortAlbumFunction=function(a,b){return a.name.toLowerCase()<b.name.toLowerCase()?-1:1},this.sortTrackFunction=function(a,b){return parseInt(a.track)>parseInt(b.track)?-1:1},this.confirmDelete=function(a){var b=window.confirm(a);return b?!0:!1},this.makeBaseAuth=function(a,b){var c=a+":"+b,d=$.base64Encode(c);return"Basic "+d},this.HexEncode=function(a){for(var b="0123456789abcdef",c=[],d=[],e=0;256>e;e++)c[e]=b.charAt(e>>4)+b.charAt(15&e);for(e=0;e<a.length;e++)d[e]=c[a.charCodeAt(e)];return d.join("")},this.switchTheme=function(a){switch(a.toLowerCase()){case"dark":$("link[data-name=theme]").attr("href","styles/Dark.c606f854.css");break;case"default":$("link[data-name=theme]").attr("href","")}},this.browserStorageCheck=function(){return"undefined"==typeof localStorage?!1:!0},this.timeToSeconds=function(a){var b,c=a.split(":");switch(c.length){case 1:b=0;break;case 2:b=60*parseInt(c[0])+parseInt(c[1]);break;case 3:b=60*parseInt(c[0])*60+60*parseInt(c[1])+parseInt(c[2])}return b},this.secondsToTime=function(a){for(var b,c=new Array(3600,60,1),d="",e=0;e<c.length;e++)b=Math.floor(a/c[e]),1>b?b="00":10>b&&(b="0"+b),0===e&&"00"===b||(d+=b,2>e&&(d+=":")),a%=c[e];return d},this.arrayObjectIndexOf=function(a,b,c){for(var d=0,e=a.length;e>d;d++)if(a[d][c]===b)return d;return-1},this.logObjectProperties=function(a){$.each(a,function(a,b){var c=a;"object"==typeof b?$.each(b,function(a,b){console.log(c+" > "+a+" : "+b)}):console.log(a+" : "+b)})},this.clickButton=function(a){var a=$(a);if(a)for(var b=$(a).attr("class").split(" "),c=0,d=b.length;d>c;++c){var e=["shuffle","mute"];if(jQuery.inArray(b[c],e)>=0){var f=b[c]+"_up";return a.hasClass(f)?(a.removeClass(f),!1):(a.addClass(f),!0)}}},this.findKeyForCode=function(a){var b={keymap:[{key:"a",code:65},{key:"b",code:66},{key:"c",code:67},{key:"d",code:68},{key:"e",code:69},{key:"f",code:70},{key:"g",code:71},{key:"h",code:72},{key:"i",code:73},{key:"j",code:74},{key:"k",code:75},{key:"l",code:76},{key:"m",code:77},{key:"n",code:78},{key:"o",code:79},{key:"p",code:80},{key:"q",code:81},{key:"r",code:82},{key:"s",code:83},{key:"t",code:84},{key:"u",code:85},{key:"v",code:86},{key:"w",code:87},{key:"x",code:88},{key:"y",code:89},{key:"z",code:90}]},c=0;return $.each(b.keymap,function(b,d){d.code===a&&(c=d.key)}),c},this.toHTML={on:function(a){for(var b=[],c=0;c<a.length;)b[c]=a.charCodeAt(c++);return"&#"+b.join(";&#")+";"},un:function(a){return a.replace(/&#(x)?([^;]{1,5});?/g,function(a,b,c){return String.fromCharCode(parseInt(c,b?16:10))})}},this.getParameterByName=function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b="[\\?&]"+a+"=([^&#]*)",c=new RegExp(b),d=c.exec(window.location.search);return null===d?"":decodeURIComponent(d[1].replace(/\+/g," "))},this.getPathFromUrl=function(a){var b=a.toString(),c=b.substring(0,b.indexOf("?"));return c},this.setTitle=function(a){""!==a&&(document.title=a)};var c=0;this.scrollTitle=function(a){var b={left:function(a){a.push(a.shift())},right:function(a){a.unshift(a.pop())}},d={text:a,dir:"left",speed:1200},e=(d.text||document.title).split("");e&&(e.push(" "),clearInterval(c),c=setInterval(function(){var a=b[d.dir];a&&(a(e),document.title=e.join(""))},d.speed))},this.parseVersionString=function(a){if("string"!=typeof a)return!1;var b=a.split("."),c=parseInt(b[0])||0,d=parseInt(b[1])||0,e=parseInt(b[2])||0;return{major:c,minor:d,patch:e}},this.checkVersion=function(a,b){return a.major>=b.major&&a.minor>=b.minor&&a.patch>=b.patch?!0:!1},this.checkVersionNewer=function(a,b){return a.major<b.major?!0:a.minor<b.minor?!0:a.patch<b.patch?!0:!1},this.reloadRoute=function(){reload?$window.location.reload():$route.reload()},this.parseDate=function(a){var b=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],c=a.split(" "),d=c[0].split("-"),e=parseInt(d[1],10)-1,f=b[e]+" "+d[2]+", "+d[0];return f}}]),angular.module("jamstash.notifications",[]).service("notifications",["$rootScope","globals",function(a,b){"use strict";this.updateMessage=function(c,d){""!==c&&(a.Messages.push(c),d?setTimeout(function(){$(el).fadeOut(function(){$(this).remove()})},b.settings.Timeout):$(el).click(function(){return $(el).fadeOut(function(){$(this).remove()}),!1}))},this.requestPermissionIfRequired=function(){window.Notify.isSupported()&&window.Notify.needsPermission()&&window.Notify.requestPermission()},this.hasNotificationPermission=function(){return window.Notify.needsPermission()===!1},this.hasNotificationSupport=function(){return window.Notify.isSupported()};var c=[];this.showNotification=function(d,e,f,g,h){if(this.hasNotificationPermission()){var i={};(h="#NextTrack")&&(i.notifyClick=function(){a.nextTrack(),this.close()}),"text"===g?(i.body=f,i.icon=d):"html"===g&&(i.body=f);var j=new Notify(e,i);c.push(j),setTimeout(function(a){a.close()},b.settings.Timeout,j),j.show()}else console.log("showNotification: No Permission")},this.closeAllNotifications=function(){for(var a in c)c[a].close()}}]),angular.module("jamstash.subsonic.service",["jamstash.settings","jamstash.utils","jamstash.model","jamstash.notifications","angular-underscore/utils"]).factory("subsonic",["$rootScope","$http","$q","globals","utils","map","notifications",function(a,b,c,d,e,f,g){"use strict";var h={shortcuts:[],artists:[]},i={album:[],song:[],playlists:[],breadcrumb:[],playlistsPublic:[],playlistsGenre:d.SavedGenres,selectedAutoAlbum:null,selectedArtist:null,selectedAlbum:null,selectedPlaylist:null,selectedAutoPlaylist:null,selectedGenre:null,selectedPodcast:null},j=[],k=[],l=0,m=!1,n=!1,o=function(a){if("undefined"!=typeof a)switch(a){case"createdate desc":i.album.sort(e.sortDateFunction);break;case"artist":i.album.sort(e.sortArtistFunction);break;case"album":i.album.sort(e.sortAlbumFunction)}};return{showIndex:m,showPlaylist:n,getSongTemplate:function(a){var c="16608",e=d.BaseURL()+"/getMusicDirectory.view?"+d.BaseParams()+"&id="+c;b.get(e).success(function(b){var c=[],d=[];"undefined"!=typeof b["subsonic-response"].directory.child&&(b["subsonic-response"].directory.child.length>0?c=b["subsonic-response"].directory.child:c[0]=b["subsonic-response"].directory.child,angular.forEach(c,function(a){a.isDir||d.push(f.mapSong(a))}),a(d))})},getArtists:function(a,b){var g=c.defer();if(b||0==h.artists.length){var i;if(e.getValue("MusicFolders")){var j=angular.fromJson(e.getValue("MusicFolders"));a=j.id}i=a?d.BaseURL()+"/getIndexes.view?"+d.BaseParams()+"&musicFolderId="+a:d.BaseURL()+"/getIndexes.view?"+d.BaseParams(),$.ajax({url:i,method:"GET",dataType:d.settings.Protocol,timeout:d.settings.Timeout,success:function(a){var b=[];"undefined"!=typeof a["subsonic-response"].indexes.index&&(a["subsonic-response"].indexes.index.length>0?b=a["subsonic-response"].indexes.index:b[0]=a["subsonic-response"].indexes.index),h.artists=[],h.shortcuts=[];var c=[];"undefined"!=typeof a["subsonic-response"].indexes.shortcut&&(a["subsonic-response"].indexes.shortcut.length>0?c=a["subsonic-response"].indexes.shortcut:c[0]=a["subsonic-response"].indexes.shortcut,angular.forEach(c,function(a){h.shortcuts.push(f.mapIndex(a))})),angular.forEach(b,function(a){h.artists.push(f.mapArtist(a))}),g.resolve(h)}})}else g.resolve(h);return g.promise},getAlbums:function(a,b){var e=c.defer();if(a){i.selectedAutoAlbum=null,i.selectedPlaylist=null,i.selectedArtist=a,i.breadcrumb=[],i.breadcrumb.push({type:"artist",id:a,name:b});var h=d.BaseURL()+"/getMusicDirectory.view?"+d.BaseParams()+"&id="+a;$.ajax({url:h,method:"GET",dataType:d.settings.Protocol,timeout:d.settings.Timeout,success:function(a){var b=[];"undefined"!=typeof a["subsonic-response"].directory.child?(a["subsonic-response"].directory.child.length>0?b=a["subsonic-response"].directory.child:b[0]=a["subsonic-response"].directory.child,i.album=[],i.song=[],angular.forEach(b,function(a){a.isDir?i.album.push(f.mapAlbum(a)):i.song.push(f.mapSong(a))}),"default"!=SelectedAlbumSort.id&&o(SelectedAlbumSort.id)):g.updateMessage("No Albums Returned :(",!0),e.resolve(i)}})}else e.resolve(i);return e.promise},getAlbumListBy:function(a,b){var e,h=c.defer();return i.selectedArtist=null,i.selectedPlaylist=null,i.selectedAutoAlbum=a,i.breadcrumb=[],"next"==b?l+=d.settings.AutoAlbumSize:"prev"==l?l-=d.settings.AutoAlbumSize:l=0,e=l>0?d.BaseURL()+"/getAlbumList.view?"+d.BaseParams()+"&size="+d.settings.AutoAlbumSize.toString()+"&type="+a+"&offset="+l:d.BaseURL()+"/getAlbumList.view?"+d.BaseParams()+"&size="+d.settings.AutoAlbumSize.toString()+"&type="+a,$.ajax({url:e,method:"GET",dataType:d.settings.Protocol,timeout:d.settings.Timeout,success:function(a){var b=[];"undefined"!=typeof a["subsonic-response"].albumList.album?(a["subsonic-response"].albumList.album.length>0?b=a["subsonic-response"].albumList.album:b[0]=a["subsonic-response"].albumList.album,i.album=[],i.song=[],angular.forEach(b,function(a){a.isDir?i.album.push(f.mapAlbum(a)):i.song.push(f.mapSong(a))}),"default"!=SelectedAlbumSort.id&&o(SelectedAlbumSort.id)):g.updateMessage("No Albums Returned :(",!0),h.resolve(i)}}),h.promise},getAlbumByTag:function(a){var b=c.defer();return $.ajax({url:d.BaseURL()+"/getAlbum.view?"+d.BaseParams()+"&id="+a,method:"GET",dataType:d.settings.Protocol,timeout:d.settings.Timeout,success:function(a){if("undefined"!=typeof a["subsonic-response"].album){i.album=[],i.song=[];var c=[];a["subsonic-response"].album.song.length>0?c=a["subsonic-response"].album.song:c[0]=a["subsonic-response"].album.song,angular.forEach(c,function(a){i.song.push(f.mapSong(a))})}b.resolve(i)}}),b.promise},getSongs:function(b,e){var h=c.defer();if(b){i.selectedAlbum=b;var j=d.BaseURL()+"/getMusicDirectory.view?"+d.BaseParams()+"&id="+b;$.ajax({url:j,method:"GET",dataType:d.settings.Protocol,timeout:d.settings.Timeout,success:function(b){var c=[];if("undefined"!=typeof b["subsonic-response"].directory.child){if(b["subsonic-response"].directory.child.length>0?c=b["subsonic-response"].directory.child:c[0]=b["subsonic-response"].directory.child,"add"==e)angular.forEach(c,function(b){a.queue.push(f.mapSong(b))}),g.updateMessage(c.length+" Song(s) Added to Queue",!0);else if("play"==e){a.queue=[],angular.forEach(c,function(b){a.queue.push(f.mapSong(b))});var d=a.queue[0];a.playSong(!1,d),g.updateMessage(c.length+" Song(s) Added to Queue",!0)}else{if("undefined"!=typeof b["subsonic-response"].directory.id){var j=b["subsonic-response"].directory.id,k=b["subsonic-response"].directory.name;i.breadcrumb.length>0&&i.breadcrumb.splice(1,i.breadcrumb.length-1),i.breadcrumb.push({type:"album",id:j,name:k})}i.song=[],i.album=[];var l=[];angular.forEach(c,function(a){a.isDir?l.push(f.mapAlbum(a)):i.song.push(f.mapSong(a))}),l.length>0&&(i.album=l,"default"!=SelectedAlbumSort.id&&o(SelectedAlbumSort.id))}h.resolve(i)}else g.updateMessage("No Songs Returned :(",!0)}})}else h.resolve(i);return h.promise},search:function(a,b){var e=c.defer();return""!==a&&$.ajax({url:d.BaseURL()+"/search2.view?"+d.BaseParams()+"&query="+a,method:"GET",dataType:d.settings.Protocol,timeout:d.settings.Timeout,success:function(a){if(""!==a["subsonic-response"].searchResult2){var c=[];"0"===b&&void 0!==a["subsonic-response"].searchResult2.song&&(a["subsonic-response"].searchResult2.song.length>0?c=a["subsonic-response"].searchResult2.song:c[0]=a["subsonic-response"].searchResult2.song,i.album=[],i.song=[],angular.forEach(c,function(a){i.song.push(f.mapSong(a))})),"1"===b&&void 0!==a["subsonic-response"].searchResult2.album&&(a["subsonic-response"].searchResult2.album.length>0?c=a["subsonic-response"].searchResult2.album:c[0]=a["subsonic-response"].searchResult2.album,i.album=[],i.song=[],angular.forEach(c,function(a){a.isDir?i.album.push(f.mapAlbum(a)):i.song.push(f.mapAlbum(a))})),"2"===b&&void 0!==a["subsonic-response"].searchResult2.artist&&(a["subsonic-response"].searchResult2.artist.length>0?c=a["subsonic-response"].searchResult2.artist:c[0]=a["subsonic-response"].searchResult2.artist,angular.forEach(c,function(a){h.shortcuts.push(a)})),e.resolve(i)}}}),e.promise},getRandomSongs:function(b,e,h){var j=c.defer();d.settings.Debug&&console.log("action:"+b+", genre:"+e+", folder:"+h);var k=d.settings.AutoPlaylistSize;i.selectedPlaylist=null,i.selectedAutoPlaylist="number"==typeof h?h:""!==e?e:"random";var l="";""!==e&&"Random"!=e&&(l="&genre="+e);var m="";return"number"==typeof h&&""!==h&&"all"!=h?m="&musicFolderId="+h:"undefined"!=typeof a.SelectedMusicFolder.id&&a.SelectedMusicFolder.id>=0&&(m="&musicFolderId="+a.SelectedMusicFolder.id),$.ajax({url:d.BaseURL()+"/getRandomSongs.view?"+d.BaseParams()+"&size="+k+l+m,method:"GET",dataType:d.settings.Protocol,timeout:d.settings.Timeout,success:function(c){if("undefined"!=typeof c["subsonic-response"].randomSongs.song){var d=[];if(c["subsonic-response"].randomSongs.song.length>0?d=c["subsonic-response"].randomSongs.song:d[0]=c["subsonic-response"].randomSongs.song,"add"==b)angular.forEach(d,function(b){a.queue.push(f.mapSong(b))}),g.updateMessage(d.length+" Song(s) Added to Queue",!0);else if("play"==b){a.queue=[],angular.forEach(d,function(b){a.queue.push(f.mapSong(b))});var e=a.queue[0];a.playSong(!1,e),g.updateMessage(d.length+" Song(s) Added to Queue",!0)}else i.album=[],i.song=[],angular.forEach(d,function(a){i.song.push(f.mapSong(a))})}j.resolve(i)}}),j.promise},getPlaylists:function(a){var b=c.defer();return d.settings.Debug&&console.log("LOAD PLAYLISTS"),a||0==i.playlists.length?$.ajax({url:d.BaseURL()+"/getPlaylists.view?"+d.BaseParams(),method:"GET",dataType:d.settings.Protocol,timeout:d.settings.Timeout,success:function(a){if(void 0!==a["subsonic-response"].playlists.playlist){var c=[];a["subsonic-response"].playlists.playlist.length>0?c=a["subsonic-response"].playlists.playlist:c[0]=a["subsonic-response"].playlists.playlist,i.playlists=[],i.playlistsPublic=[],angular.forEach(c,function(a){a.owner==d.settings.Username?i.playlists.push(a):a.public&&i.playlistsPublic.push(a)}),b.resolve(i)}}}):b.resolve(i),b.promise},getPlaylist:function(b,e){var h=c.defer();return i.selectedAutoPlaylist=null,i.selectedPlaylist=b,$.ajax({url:d.BaseURL()+"/getPlaylist.view?"+d.BaseParams()+"&id="+b,method:"GET",dataType:d.settings.Protocol,timeout:d.settings.Timeout,success:function(b){if("undefined"!=typeof b["subsonic-response"].playlist.entry){var c=[],d=b["subsonic-response"].playlist;if(d.entry.length>0?c=d.entry:c[0]=d.entry,"add"==e)angular.forEach(c,function(b){a.queue.push(f.mapSong(b))}),g.updateMessage(c.length+" Song(s) Added to Queue",!0);else if("play"==e){a.queue=[],angular.forEach(c,function(b){a.queue.push(f.mapSong(b))});var j=a.queue[0];a.playSong(!1,j),g.updateMessage(c.length+" Song(s) Added to Queue",!0)}else i.album=[],i.song=[],angular.forEach(c,function(a){i.song.push(f.mapSong(a))}),g.updateMessage(c.length+" Song(s) in Playlist",!0)}else i.song=[];h.resolve(i)}}),h.promise},getStarred:function(){var a,e={reason:"Error when contacting the Subsonic server."},f=c.defer();return a="jsonp"===d.settings.Protocol?b.jsonp(d.BaseURL()+"/getStarred.view?callback=JSON_CALLBACK&"+d.BaseParams(),{timeout:d.settings.Timeout,cache:!0}):b.get(d.BaseURL()+"/getStarred.view?"+d.BaseParams(),{timeout:d.settings.Timeout,cache:!0}),a.success(function(a){var b=void 0!==a["subsonic-response"]?a["subsonic-response"]:{status:"failed"};"ok"===b.status?angular.equals(b.starred,{})?f.reject({reason:"Nothing is starred on the Subsonic server."}):f.resolve(b.starred):("failed"===b.status&&void 0!==b.error&&(e.subsonicError=b.error),f.reject(e))}).error(function(a,b){e.httpError=b,f.reject(e)}),f.promise},getRandomStarredSongs:function(){var a={reason:"No starred songs found on the Subsonic server."},b=c.defer();return this.getStarred().then(function(c){if(void 0!==c.song&&c.song.length>0){var e=[].concat(_.sample(c.song,d.settings.AutoPlaylistSize));b.resolve(e)}else b.reject(a)},function(a){b.reject(a)}),b.promise},newPlaylist:function(){var a=c.defer(),b=prompt("Choose a name for your new playlist.","");return"null"!=b&&null!==b&&""!==b&&$.ajax({url:d.BaseURL()+"/createPlaylist.view?"+d.BaseParams()+"&name="+b,method:"GET",dataType:d.settings.Protocol,timeout:d.settings.Timeout,success:function(){a.resolve()}}),a.promise},deletePlaylist:function(){var a=c.defer();if(null!==i.selectedPlaylist){var b=i.selectedPlaylist;e.confirmDelete("Are you sure you want to delete the selected playlist?")&&$.ajax({url:d.BaseURL()+"/deletePlaylist.view?"+d.BaseParams()+"&id="+b,method:"GET",dataType:d.settings.Protocol,timeout:d.settings.Timeout,success:function(){a.resolve()}})}return a.promise},savePlaylist:function(){var a=c.defer();if(null!==i.selectedPlaylist){var b=i.selectedPlaylist,e=[];angular.forEach(i.song,function(a){e.push(a.id)}),e.length>0&&$.ajax({type:"GET",url:d.BaseURL()+"/createPlaylist.view?"+d.BaseParams(),dataType:d.settings.Protocol,timeout:d.settings.Timeout,data:{playlistId:b,songId:e},success:function(){a.resolve()},traditional:!0})}return a.promise},songsRemoveSelected:function(a){var b=c.defer();return angular.forEach(a,function(a){var b=i.song.indexOf(a);i.song.splice(b,1)}),b.resolve(i),b.promise},getGenres:function(){var a=c.defer(),b="Acid Rock,Acoustic,Alt Country,Alt/Indie,Alternative & Punk,Alternative Metal,Alternative,AlternRock,Awesome,Bluegrass,Blues,Blues-Rock,Classic Hard Rock,Classic Rock,Comedy,Country,Country-Rock,Dance,Dance-Rock,Deep Funk,Easy Listening,Electronic,Electronica,Electronica/Dance,Folk,Folk/Rock,Funk,Grunge,Hard Rock,Heavy Metal,Holiday,House,Improg,Indie Rock,Indie,International,Irish,Jam Band,Jam,Jazz Fusion,Jazz,Latin,Live Albums,Metal,Music,Oldies,Other,Pop,Pop/Rock,Post Rock,Progressive Rock,Psychedelic Rock,Psychedelic,Punk,R&B,Rap & Hip-Hop,Reggae,Rock & Roll,Rock,Rock/Pop,Roots,Ska,Soft Rock,Soul,Southern Rock,Thrash Metal,Unknown,Vocal,World";return j=b.split(","),a.resolve(j),a.promise},getPodcasts:function(){var a=c.defer();return d.settings.Debug&&console.log("LOAD PODCASTS"),$.ajax({url:d.BaseURL()+"/getPodcasts.view?"+d.BaseParams(),method:"GET",dataType:d.settings.Protocol,timeout:d.settings.Timeout,success:function(b){if(void 0!==b["subsonic-response"].podcasts.channel){var c=[];b["subsonic-response"].podcasts.channel.length>0?c=b["subsonic-response"].podcasts.channel:c[0]=b["subsonic-response"].podcasts.channel,k=c}a.resolve(k)}}),a.promise},getPodcast:function(b,e){var h=c.defer();return i.selectedPodcast=b,$.ajax({url:d.BaseURL()+"/getPodcasts.view?"+d.BaseParams(),method:"GET",dataType:d.settings.Protocol,timeout:d.settings.Timeout,success:function(c){if(void 0!==c["subsonic-response"].podcasts.channel){var d=[];c["subsonic-response"].podcasts.channel.length>0?d=c["subsonic-response"].podcasts.channel:d[0]=c["subsonic-response"].podcasts.channel;var j=[];if($.each(d,function(a,c){c.id==b&&(j=c.episode)}),"undefined"!=typeof j)if("add"==e)angular.forEach(j,function(b){"skipped"!=b.status&&a.queue.push(f.mapPodcast(b))}),g.updateMessage(j.length+" Song(s) Added to Queue",!0);else if("play"==e){a.queue=[],angular.forEach(j,function(b){"skipped"!=b.status&&a.queue.push(f.mapPodcast(b))});var k=a.queue[0];a.playSong(!1,k),g.updateMessage(j.length+" Song(s) Added to Queue",!0)}else i.album=[],i.song=[],angular.forEach(j,function(a){"skipped"!=a.status&&i.song.push(f.mapPodcast(a))})}h.resolve(i)}}),h.promise}}}]),angular.module("jamstash.archive.service",["jamstash.settings","jamstash.model","jamstash.notifications"]).factory("archive",["$rootScope","$http","$q","$sce","globals","model","utils","map","notifications",function(a,b,c,d,e,f,g,h,i){"use strict";var j={artist:[],album:[],song:[],breadcrumb:[],selectedArtist:null,selectedAlbum:null,selectedGenre:null,selectedArchiveAlbumSort:"date desc"},k=function(a){var b,c,g,h,i,j,k,l,m,n,o,p=a,q=e.archiveUrl+"details/"+p.identifier;b="images/albumdefault_50.7c4beb44.jpg",c="images/albumdefault_160.jpg",g=5==parseInt(p.avg_rating)?!0:!1,h="undefined"==typeof p.title?"&nbsp;":p.title.toString(),m="undefined"==typeof p.identifier?"&nbsp;":p.identifier.toString(),i="undefined"==typeof p.collection[0]?"&nbsp;":p.collection[0].toString(),n="undefined"==typeof p.source?"&nbsp;":p.source.toString(),o="undefined"==typeof p.date?"&nbsp;":p.date.toString(),j="undefined"==typeof p.publisher?"&nbsp;":p.publisher.toString(),k="undefined"==typeof p.avg_rating?"&nbsp;":p.avg_rating.toString(),l="undefined"==typeof p.downloads?"&nbsp;":p.downloads.toString();var r="<b>Source</b>: "+n+"<br />";return r+="<b>Date</b>: "+o+"<br />",r+="<b>Transferer</b>: "+j+"<br />",r+="<b>Rating</b>: "+k+"<br />",r+="<b>Downloads</b>: "+l+"<br />",new f.Album(m,null,h,i,"",b,c,$.format.date(new Date(p.publicdate),"yyyy-MM-dd h:mm a"),g,d.trustAsHtml(r),q)},l=function(a,b,c,d,e,h){var i,j,k,l,m="";return"VBR MP3"==b.format?(i="http://"+c+d+a,m="undefined"==typeof b.bitrate||"undefined"==typeof b.format?"&nbsp;":b.bitrate+"kbps, "+b.format.toLowerCase(),k="undefined"==typeof b.track?"&nbsp;":b.track,l="undefined"==typeof b.title?"&nbsp;":b.title,j="undefined"==typeof b.length?"&nbsp;":g.timeToSeconds(b.length),new f.Song(b.md5,e,b.track,l,b.creator,"",b.album,"",h,h,j,"","","mp3",m,i,0,"")):void 0};return{getArtists:function(a){var b=c.defer();e.settings.Debug&&console.log("LOAD ARCHIVE.ORG COLLECTIONS");var d=e.archiveUrl+"advancedsearch.php?q=";return d+=""!==a?"mediatype:(collection) AND identifier:("+a+")":"collection:(collection)",d+="&fl[]=identifier&sort[]=&sort[]=&sort[]=&rows=50&page=1&output=json",$.ajax({url:d,method:"GET",dataType:e.settings.Protocol,timeout:e.settings.Timeout,success:function(a){if(a.response.docs.length>0){var c=a.response.docs;j.artist=[],angular.forEach(c,function(a){j.artist.push(a.identifier)})}else i.updateMessage("Sorry :(",!0);b.resolve(j)}}),b.promise},getAlbums:function(a,b){var d=c.defer();if(a){var f=e.archiveUrl+"advancedsearch.php?q=";""!==a?(j.selectedArtist=a,f+="collection:("+a+") AND format:(MP3)"):j.selectedArtist?(a=j.selectedArtist,f+="collection:("+j.selectedArtist+") AND format:(MP3)"):f+="collection:("+a+")",j.breadcrumb=[],j.breadcrumb.push({type:"artist",id:a,name:a}),b.Source&&(f+=" AND source:("+b.Source+")"),b.Year&&parseInt(b.Year)&&(f+=" AND year:("+b.Year+")"),b.Description&&(f+=" AND description:("+b.Description+")"),j.selectedArtist&&(f+="&sort[]="+e.settings.DefaultArchiveAlbumSort),f+="&fl[]=avg_rating,collection,date,description,downloads,headerImage,identifier,publisher,publicdate,source,subject,title,year",f+="&rows=50&page=1&output=json",$.ajax({url:f,method:"GET",dataType:e.settings.Protocol,timeout:e.settings.Timeout,success:function(a){var b=[];a.response.docs.length>0?(b=a.response.docs,j.album=[],j.song=[],angular.forEach(b,function(a){j.album.push(k(a))}),i.updateMessage(j.album.length,!0)):i.updateMessage("Sorry :(",!0),d.resolve(j)},error:function(){i.updateMessage("Archive.org service down :(")}})}else d.resolve(j);return d.promise},getSongs:function(b,d){var f=c.defer();if(b){j.selectedAlbum=b,j.breadcrumb.length>0&&j.breadcrumb.splice(1,j.breadcrumb.length-1),j.breadcrumb.push({type:"album",id:b,name:b});var g=e.archiveUrl+"details/"+b+"?output=json";$.ajax({url:g,method:"GET",dataType:e.settings.Protocol,timeout:e.settings.Timeout,success:function(b){var c="",e=b.server,g=b.dir,h=b.metadata.identifier[0];"undefined"!=typeof b.misc.image&&(c=b.misc.image);var k=b.files;if("add"==d)angular.forEach(k,function(b,d){var f=l(d,b,e,g,h,c);f&&a.queue.push(f)}),i.updateMessage(Object.keys(k).length+" Song(s) Added to Queue",!0);else if("play"==d){a.queue=[],angular.forEach(k,function(b,d){var f=l(d,b,e,g,h,c);f&&a.queue.push(f)});var m=a.queue[0];a.playSong(!1,m),i.updateMessage(Object.keys(k).length+" Song(s) Added to Queue",!0)}else j.album=[],j.song=[],angular.forEach(k,function(a,b){var d=l(b,a,e,g,h,c);d&&j.song.push(d)});f.resolve(j)}})}else f.resolve(j);return f.promise}}}]),angular.module("JamStash").service("player",["$rootScope","$window","utils","globals","model","notifications",function(a,b,c,d,e,f){"use strict";function g(b){var c;if(d.settings.Debug&&console.log("Getting Next Song > Queue length: "+a.queue.length),a.queue.length>0){angular.forEach(a.queue,function(a){a.playing===!0?c=a:a.playing=!1
});var e,f=a.queue.indexOf(c);return e=b?a.queue[f-1]:a.queue[f+1],"undefined"!=typeof e?(d.settings.Debug&&console.log("Next Song: "+e.id),e):!1}return!1}function h(b){if(a.loggedIn&&b){var c=a.playingSong.id;d.settings.Debug&&console.log("Scrobble Song: "+c),$.ajax({url:d.BaseURL()+"/scrobble.view?"+d.BaseParams()+"&id="+c+"&submission="+b,method:"GET",dataType:d.settings.Protocol,timeout:1e4,success:function(){j=!0}})}}var i=d.Player1,j=!1,k=0;a.defaultPlay=function(){"undefined"==typeof $(i).data("jPlayer")&&a.nextTrack(),"undefined"!=typeof $(i).data("jPlayer")&&d.settings.Jukebox&&a.sendToJukebox($(i).data("jPlayer").status.paused?"start":"stop")},a.nextTrack=function(){var b=g();b&&a.playSong(!1,b)},a.previousTrack=function(){var b=g(!0);b?a.playSong(!1,b):a.restartSong()},this.startSaveTrackPosition=function(){d.settings.SaveTrackPosition&&(0!==k&&clearInterval(k),k=b.setInterval(function(){d.settings.SaveTrackPosition&&this.saveTrackPosition()},3e4))},this.toggleMute=function(){var a=$(i).data("jPlayer");"undefined"!=typeof a&&(a.options.muted=a.options.muted?!1:!0)},this.saveTrackPosition=function(){var b=$(i).data("jPlayer");if("undefined"!=typeof b){if(b.status.currentTime>0&&b.status.paused===!1){var e;if(angular.forEach(a.queue,function(a){a.playing===!0&&(e=a)}),e){var f=b.status.currentTime;if(null!==f)if($("#action_SaveProgress").fadeTo("slow",0).delay(500).fadeTo("slow",1).delay(500).fadeTo("slow",0).delay(500).fadeTo("slow",1),e.position=f,c.browserStorageCheck())try{var g=angular.toJson(e);localStorage.setItem("CurrentSong",g),d.settings.Debug&&console.log("Saving Current Position: "+g);var h=localStorage.getItem("CurrentQueue");if(a.queue.length>0){var j=a.queue;j!=h&&(localStorage.setItem("CurrentQueue",angular.toJson(j)),d.settings.Debug&&console.log("Saving Queue: "+j.length+" characters"))}}catch(k){k==QUOTA_EXCEEDED_ERR&&alert("Quota exceeded!")}else d.settings.Debug&&console.log("HTML5::loadStorage not supported on your browser")}}}else d.settings.Debug&&console.log("Saving Queue: No Audio Loaded")},this.loadTrackPosition=function(){if(c.browserStorageCheck()){var b=angular.fromJson(localStorage.getItem("CurrentSong"));if(b){a.playSong(!0,b);var e=angular.fromJson(localStorage.getItem("CurrentQueue"));e&&(a.queue=e,a.queue.length>0&&f.updateMessage(a.queue.length+" Saved Song(s)",!0),d.settings.Debug&&console.log("Play Queue Loaded From localStorage: "+a.queue.length+" song(s)"))}}else d.settings.Debug&&console.log("HTML5::loadStorage not supported on your browser")},this.deleteCurrentQueue=function(){c.browserStorageCheck()?(localStorage.removeItem("CurrentQueue"),c.setValue("CurrentSong",null,!1),d.settings.Debug&&console.log("Removing Play Queue")):d.settings.Debug&&console.log("HTML5::loadStorage not supported on your browser, "+html.length+" characters")},a.restartSong=function(){var a=$(i).data("jPlayer");a.play(0)},a.playSong=function(b,e){d.settings.Debug&&console.log("Play: "+JSON.stringify(e,null,2)),angular.forEach(a.queue,function(a){a.playing=!1}),e.playing=!0,e.selected=!1,null!=a.playingSong&&e.id!=a.playingSong.id&&$.fancybox.isOpen&&c.fancyboxOpenImage(e.coverartfull),a.playingSong=e;{var g=e.id,h=e.url,k=e.position,l=e.name,m=e.album,n=e.artist,o=e.suffix,p=(e.specs,e.coverartthumb);e.coverartfull,e.starred}$("#playermiddle").css("visibility","visible"),$("#songdetails").css("visibility","visible"),d.settings.Jukebox?(a.addToJukebox(g),a.loadjPlayer(i,h,o,!0,k)):a.loadjPlayer(i,h,o,b,k);for(var q="",e=$(i).data().jPlayer,r=0;r<e.solutions.length;r++){var s=e.solutions[r];e[s].used&&(q+='<strong class="codesyntax">'+s+"</strong> is",q+=" currently being used with<strong>",angular.forEach(e[s].support,function(a){e[s].support[a]&&(q+=' <strong class="codesyntax">'+a+"</strong>")}),q+="</strong> support")}$("#SMStats").html(q),j=!1,a.queue.length>0&&$("#queue").stop().scrollTo("#"+g,400),d.settings.NotificationSong&&!b&&f.showNotification(p,c.toHTML.un(l),c.toHTML.un(n+" - "+m),"text","#NextTrack"),d.settings.ScrollTitle?c.scrollTitle(c.toHTML.un(n)+" - "+c.toHTML.un(l)):c.setTitle(c.toHTML.un(n)+" - "+c.toHTML.un(l)),a.$root.$$phase||a.$apply()},a.loadjPlayer=function(b,e,k,l,m){var n=1;c.getValue("Volume")&&(n=parseFloat(c.getValue("Volume")));var o="html,flash";d.settings.ForceFlash&&(o="flash,html"),d.settings.Debug&&console.log("Setting Audio Solution: "+o);var p=!1;d.settings.Jukebox&&(p=!0),$(b).jPlayer("destroy"),$.jPlayer.timeFormat.showHour=!0,$(b).jPlayer({swfPath:"js/plugins/jplayer",wmode:"window",solution:o,supplied:k,volume:n,muted:p,errorAlerts:!1,warningAlerts:!1,cssSelectorAncestor:"",cssSelector:{play:".PlayTrack",pause:".PauseTrack",seekBar:"#audiocontainer .scrubber",playBar:"#audiocontainer .progress",mute:"#action_Mute",unmute:"#action_UnMute",volumeMax:"#action_VolumeMax",currentTime:"#played",duration:"#duration"},ready:function(){console.log("File Suffix: "+k),"oga"==k?$(this).jPlayer("setMedia",{oga:e}):"m4a"==k?$(this).jPlayer("setMedia",{m4a:e}):"mp3"==k&&$(this).jPlayer("setMedia",{mp3:e}),l?$(this).jPlayer("pause",m):$(this).jPlayer("play"),d.settings.Debug&&(console.log("[jPlayer Version Info]"),c.logObjectProperties($(b).data("jPlayer").version),console.log("[HTML5 Debug Info]"),c.logObjectProperties($(b).data("jPlayer").html),console.log("[Flash Debug Info]"),c.logObjectProperties($(b).data("jPlayer").flash),console.log("[jPlayer Options Info]"),c.logObjectProperties($(b).data("jPlayer").options))},timeupdate:function(a){var b=a.jPlayer.status.currentPercentAbsolute;!j&&b>30&&(d.settings.Debug&&console.log("LAST.FM SCROBBLE - Percent Played: "+b),h(!0))},volumechange:function(a){c.setValue("Volume",a.jPlayer.options.volume,!0)},ended:function(){if(d.settings.Repeat)$(this).jPlayer("play");else if(g())a.nextTrack();else if(d.settings.LoopQueue){var b=a.queue[0];a.playSong(!1,b)}else d.settings.AutoPlay&&(a.getRandomSongs("play","",""),f.updateMessage("Auto Play Activated...",!0))},error:function(a){var b=$(i).data("jPlayer").status.currentTime;$(i).jPlayer("play",b),d.settings.Debug&&(console.log("Error Type: "+a.jPlayer.error.type),console.log("Error Context: "+a.jPlayer.error.context),console.log("Error Message: "+a.jPlayer.error.message),console.log("Stream interrupted, retrying from position: "+b))}})},this.playPauseSong=function(){"undefined"!=typeof $(i).data("jPlayer")&&$(i).jPlayer($(i).data("jPlayer").status.paused?"play":"pause")},this.playVideo=function(a,b){var c,d;b=parseInt(b),600>=b?(c=320,d=240):1e3>=b?(c=480,d=360):(c=640,d=480),$("#videodeck").jPlayer({ready:function(){$(this).jPlayer("setMedia",{m4v:"https://&id="+a+"&salt=83132"}).jPlayer("play"),$("#videooverlay").show()},swfPath:"js/jplayer",solution:"html, flash",supplied:"m4v"})},this.scrobbleSong=h,this.rateSong=function(a,b){$.ajax({url:baseURL+"/setRating.view?"+baseParams+"&id="+a+"&rating="+b,method:"GET",dataType:protocol,timeout:1e4,success:function(){updateMessage("Rating Updated!",!0)}})}}]),angular.module("JamStash").controller("AppCtrl",["$scope","$rootScope","$document","$window","$location","$cookieStore","utils","globals","model","notifications","player",function(a,b,c,d,e,f,g,h,i,j,k){"use strict";b.settings=h.settings,b.song=[],b.queue=[],b.playingSong=null,b.MusicFolders=[],b.Genres=[],b.Messages=[],b.SelectedMusicFolder="",b.unity=null,b.loggedIn=function(){return""!==h.settings.Server&&""!==h.settings.Username&&""!==h.settings.Password?!0:!1},b.totalDisplayed=50,b.loadMore=function(){a.totalDisplayed+=50},b.go=function(a){e.path(a)},a.loadSettings=function(){f.get("Settings")&&(g.setValue("Settings",f.get("Settings"),!1),f.remove("Settings")),g.getValue("Settings")&&$.each(g.getValue("Settings"),function(a,b){"false"==b&&(b=!1),"true"==b&&(b=!0);var c=["Url"],d=c.indexOf(a);-1===d&&(h.settings[a]=b)}),g.getValue("SavedCollections")&&(h.SavedCollections=g.getValue("SavedCollections").split(",")),g.getValue("DefaultCollection")&&(h.DefaultCollection=g.getValue("DefaultCollection")),g.getValue("SavedGenres")&&(h.SavedGenres=g.getValue("SavedGenres").split(",")),h.settings.Debug&&console.log("Loaded Settings: "+JSON.stringify(h.settings,null,2))},a.toggleSetting=function(a){var b=a;h.settings[b]=h.settings[b]?!1:!0,j.updateMessage(a+" : "+h.settings[b],!0)},$.ajaxSetup({beforeSend:function(){$("#loading").show()},complete:function(){$("#loading").hide()}});var l=!1;$("div.submenu").mouseenter(function(){l=!0}),$("div.submenu").mouseleave(function(){l=!1,$("div.submenu").hide()}),a.toggleSubmenu=function(a,b,c,d){var e=$(a);if("none"!==e.css("display"))e.fadeOut();else{{var f=$(b),g=f.offset();f.width(),f.height()}switch(c){case"right":e.css({left:g.left+d+"px",top:g.top+"px"}).fadeIn(400);break;case"left":e.css({left:g.left-d+"px",top:g.top+"px"}).fadeIn(400)}setTimeout(function(){l===!1&&$("div.submenu").stop().fadeOut()},1e4)}},b.showQueue=function(){$("#SideBar").css("display",""),$("#right-component").removeClass("lgcolumn_expanded")},b.hideQueue=function(){$("#SideBar").css("display","none"),$("#right-component").addClass("lgcolumn_expanded")},a.toggleQueue=function(){"none"==$("#SideBar").css("display")?b.showQueue():b.hideQueue()},b.showArtists=function(){$("#left-component").css("display",""),$("#right-component").removeClass("lgcolumn_expandedleft")},b.hideArtists=function(){$("#left-component").css("display","none"),$("#right-component").addClass("lgcolumn_expandedleft")},a.toggleArtists=function(){"none"==$("#left-component").css("display")?b.showArtists():b.hideArtists()},a.fancyboxOpenImage=function(a){g.fancyboxOpenImage(a)},$("#audiocontainer .scrubber").mouseover(function(){$(".audiojs .scrubber").stop().animate({height:"8px"})}),$("#audiocontainer .scrubber").mouseout(function(){$(".audiojs .scrubber").stop().animate({height:"4px"})}),$(document).on("click",".message",function(){$(this).remove()}),window.onbeforeunload=function(){return!h.settings.Debug&&b.queue.length>0?"You're about to end your session, are you sure?":void 0},a.dragStart=function(a,b){b.item.data("start",b.item.index())},a.dragEnd=function(c,d){var e=d.item.data("start"),f=d.item.index();b.queue.splice(f,0,b.queue.splice(e,1)[0]),a.$apply()},c.keydown(function(b){a.scrollToIndex(b)}),a.scrollToIndex=function(a){var c=a.target.id;if("INPUT"!=a.target.tagName.toUpperCase()){var d=a.charCode?a.charCode:a.keyCode;if(h.settings.Debug&&console.log("Keycode Triggered: "+d),49==d?$("#action_Queue").click():50==d?$("#action_Library").click():51==d?$("#action_Archive").click():52==d&&$("#action_Settings").click(),d>=65&&90>=d&&$("#tabLibrary").is(":visible")){var e=g.findKeyForCode(d);("x"==e||"y"==e||"z"==e)&&(e="x-z");var f="#"+e.toUpperCase();$(f).length>0&&$("#left-component").stop().scrollTo(f,400)}else if(39==d||176==d)b.nextTrack();else if(37==d||177==d)b.previousTrack();else{if(32==d||179==d||"0179"==d.toString())return k.playPauseSong(),!1;36==d&&$("#tabLibrary").is(":visible")&&$("#left-component").stop().scrollTo("#MusicFolders",400)}if(189==d){var i=g.getValue("Volume")?parseFloat(g.getValue("Volume")):1;1>=i&&i>0&&""===c&&(i+=-.1,$(h.Player1).jPlayer({volume:i}),g.setValue("Volume",i,!0),h.settings.Debug&&console.log("Volume: "+Math.round(100*i)+"%"))}if(187==d){var i=g.getValue("Volume")?parseFloat(g.getValue("Volume")):1;1>i&&i>=0&&0==c&&(i+=.1,$(h.Player1).jPlayer({volume:i}),g.setValue("Volume",i,!0),h.settings.Debug&&console.log("Volume: "+Math.round(100*i)+"%"))}}return!0},a.scrollToIndexName=function(a){var b="#"+a;$(b).length>0&&$("#left-component").stop().scrollTo(b,400)},a.scrollToTop=function(){$("#left-component").stop().scrollTo("#MusicFolders",400)},b.selectAll=function(b){angular.forEach(b,function(b){a.selectedSongs.push(b),b.selected=!0})},b.selectNone=function(b){angular.forEach(b,function(b){a.selectedSongs=[],b.selected=!1})},b.playAll=function(a){b.queue=[],b.selectAll(a),b.addSongsToQueue();var c=b.queue[0];b.playSong(!1,c)},b.playFrom=function(c,d){var e=d.slice(c,d.length);if(a.selectedSongs=[],angular.forEach(e,function(b){a.selectedSongs.push(b),b.selected=!0}),a.selectedSongs.length>0){b.queue=[],b.addSongsToQueue();var f=b.queue[0];b.playSong(!1,f)}},b.addSongsToQueue=function(){0!==a.selectedSongs.length&&(angular.forEach(a.selectedSongs,function(a){b.queue.push(a),a.selected=!1}),j.updateMessage(a.selectedSongs.length+" Song(s) Added to Queue",!0),a.selectedSongs.length=0)},a.addSongToQueue=function(a){b.queue.push(a)},b.removeSong=function(a,b){var c=b.indexOf(a);b.splice(c,1)},a.removeSongFromQueue=function(a){var c=b.queue.indexOf(a);b.queue.splice(c,1)},a.isActive=function(a){return a===e.path()},b.reloadRoute=function(a){g.reloadRoute(a)},b.getSplitPosition=function(a,b){window.alert(b.getBoundingClientRect().left)},a.download=function(a){$.ajax({url:h.BaseURL()+"/getUser.view?"+h.BaseParams()+"&username="+h.settings.Username,method:"GET",dataType:h.settings.Protocol,timeout:h.settings.Timeout,success:function(b){"undefined"!=typeof b["subsonic-response"].error?j.updateMessage("Error: "+b["subsonic-response"].error.message,!0):b["subsonic-response"].user.downloadRole===!0?d.location.href=h.BaseURL()+"/download.view?"+h.BaseParams()+"&id="+a:j.updateMessage("You do not have permission to Download",!0)}})},a.ping=function(){$.ajax({url:h.BaseURL()+"/ping.view?"+h.BaseParams(),method:"GET",dataType:h.settings.Protocol,timeout:h.settings.Timeout,success:function(a){"ok"==a["subsonic-response"].status?h.settings.ApiVersion=a["subsonic-response"].version:"undefined"!=typeof a["subsonic-response"].error&&j.updateMessage(a["subsonic-response"].error.message)},error:function(){j.updateMessage("Unable to connect to Subsonic server")}})},a.queueRemoveSelected=function(){angular.forEach(a.selectedSongs,function(a){var c=b.queue.indexOf(a);c>-1&&b.queue.splice(c,1)})},a.queueEmpty=function(){b.queue=[],$.fancybox.close()},a.queueTotal=function(){var a=0;return g.arrayForEach(self.queue(),function(b){a+=parseInt(b.duration())}),self.queue().length>0?self.queue().length+" song(s), "+g.secondsToTime(a)+" total time":"0 song(s), 00:00:00 total time"},a.queueShuffle=function(){b.queue.sort(function(){return.5-Math.random()})},a.selectedSongs=[],a.selectSong=function(b){var c=a.selectedSongs.indexOf(b);c>=0?(a.selectedSongs.splice(c,1),b.selected=!1):(a.selectedSongs.push(b),b.selected=!0)},b.addToJukebox=function(a){h.settings.Debug&&console.log("LOAD JUKEBOX"),$.ajax({url:h.BaseURL()+"/jukeboxControl.view?"+h.BaseParams()+"&action=set&id="+a,method:"GET",dataType:h.settings.Protocol,timeout:h.settings.Timeout,success:function(){$.get(h.BaseURL()+"/jukeboxControl.view?"+h.BaseParams()+"&action=start")}})},b.sendToJukebox=function(a){h.settings.Debug&&console.log("SEND JUKEBOX "+a),$.ajax({url:h.BaseURL()+"/jukeboxControl.view?"+h.BaseParams()+"&action="+a,method:"GET",dataType:h.settings.Protocol,timeout:h.settings.Timeout,success:function(){}})},a.updateFavorite=function(a){var b,c=a.id,d=a.starred;d?(b=h.BaseURL()+"/unstar.view?"+h.BaseParams()+"&id="+c,a.starred=void 0):(b=h.BaseURL()+"/star.view?"+h.BaseParams()+"&id="+c,a.starred=!0),$.ajax({url:b,method:"GET",dataType:h.settings.Protocol,timeout:h.settings.Timeout,success:function(){j.updateMessage("Favorite Updated!",!0)}})},a.toTrusted=function(a){return $sce.trustAsHtml(a)},a.loadSettings(),g.switchTheme(h.settings.Theme),h.settings.ShowQueue||b.hideQueue(),a.loggedIn()&&h.settings.SaveTrackPosition&&(k.loadTrackPosition(),k.startSaveTrackPosition())}]),angular.module("JamStash").controller("SettingsCtrl",["$rootScope","$scope","$routeParams","$location","utils","globals","json","notifications","player",function(a,b,c,d,e,f,g,h,i){"use strict";b.settings=f.settings,b.Timeouts=[{id:1e4,name:10},{id:2e4,name:20},{id:3e4,name:30},{id:4e4,name:40},{id:5e4,name:50},{id:6e4,name:60},{id:9e4,name:90},{id:12e4,name:120}],b.Protocols=["json","jsonp"],b.Themes=["Default","Dark"],b.SearchTypes=f.SearchTypes,b.Layouts=f.Layouts,b.$watch("settings.HideAZ",function(){f.settings.HideAZ?$("#AZIndex").hide():$("#AZIndex").show()}),b.reset=function(){e.setValue("Settings",null,!0),b.loadSettings()},b.save=function(){""!==b.settings.Password&&"enc:"!=f.settings.Password.substring(0,4)&&(b.settings.Password="enc:"+e.HexEncode(b.settings.Password)),0!=b.settings.Server.indexOf("http://")&&0!=b.settings.Server.indexOf("https://")&&(b.settings.Server="http://"+b.settings.Server),b.settings.NotificationSong&&(h.requestPermissionIfRequired(),h.hasNotificationSupport()||alert("HTML5 Notifications are not available for your current browser, Sorry :(")),b.settings.NotificationNowPlaying&&(h.requestPermissionIfRequired(),h.hasNotificationSupport()||alert("HTML5 Notifications are not available for your current browser, Sorry :(")),b.settings.SaveTrackPosition?i.saveTrackPosition():i.deleteCurrentQueue(),b.settings.Theme&&e.switchTheme(f.settings.Theme),b.settings.ShowQueue?a.showQueue():a.hideQueue(),e.setValue("Settings",b.settings,!0),h.updateMessage("Settings Updated!",!0),b.loadSettings(),""!==f.settings.Server&&""!==f.settings.Username&&""!==f.settings.Password&&b.ping()},g.getChangeLog(function(a){b.changeLog=a.slice(0,10),f.ChangeLog=a,e.getValue("JamstashVersion")||e.setValue("JamstashVersion",b.changeLog[0].version);var c=b.changeLog[0].version,d=e.getValue("JamstashVersion");h.updateMessage("Latest Version: "+b.changeLog[0].version+'<a href="" ng-click="reloadRoute(false); return false;">Reload</a>',!0),e.checkVersionNewer(d,c)&&e.setValue("JamstashVersion",b.changeLog[0].version)}),b.changeLogShowMore=function(){g.getChangeLog(function(a){b.changeLog=a})},b.setupDemo=function(){var a="android-guest",b="guest",c="http://demo.subsonic.org";e.confirmDelete("Do you want to connect to the Subsonic Demo server?")&&(f.settings.Username=a,f.settings.Password=b,f.settings.Server=c,d.url("/library"))},"undefined"!=typeof d.search().url&&""===b.settings.Server&&(f.settings.Debug&&console.log("Setting Provided: "+d.search().url),b.settings.Server=d.search().url),"undefined"!=typeof d.search().u&&""===b.settings.Username&&(f.settings.Debug&&console.log("Setting Provided: "+d.search().u),b.settings.Username=d.search().u)}]),angular.module("jamstash.subsonic.ctrl",["jamstash.subsonic.service"]).controller("SubsonicCtrl",["$scope","$rootScope","$routeParams","utils","globals","map","subsonic","notifications",function(a,b,c,d,e,f,g,h){"use strict";a.settings=e.settings,a.itemType="ss",a.Server=e.settings.Server,a.playlistMenu=[],a.AutoAlbums=[{id:"random",name:"Random"},{id:"newest",name:"Recently Added"},{id:"starred",name:"Starred"},{id:"highest",name:"Top Rated"},{id:"frequent",name:"Most Played"},{id:"recent",name:"Recently Played"}],a.SelectedAlbumSort=e.settings.DefaultAlbumSort,a.AlbumSort=e.AlbumSorts,a.showIndex=g.showIndex,a.$watch("showIndex",function(b,c){b!==c&&(g.showIndex=a.showIndex)}),a.toggleIndex=function(){a.showIndex?a.showIndex=!1:(a.showIndex=!0,a.showPlaylist=!1,a.showPodcast=!1),a.saveDefaultSection("index")},a.showPlaylist=g.showPlaylist,a.$watch("showPlaylist",function(b,c){b!==c&&(g.showPlaylist=a.showPlaylist)}),a.togglePlaylist=function(){a.showPlaylist?a.showPlaylist=!1:(a.showPlaylist=!0,a.showIndex=!1,a.showPodcast=!1),a.saveDefaultSection("playlist")},a.showPodcast=g.showPodcast,a.$watch("showPodcast",function(b,c){b!==c&&(g.showPodcast=a.showPodcast)}),a.togglePodcast=function(){a.showPodcast?a.showPodcast=!1:(a.showPodcast=!0,a.showPlaylist=!1,a.showIndex=!1),a.saveDefaultSection("podcast")},a.saveDefaultSection=function(a){d.setValue("DefaultSection",a,!1)},a.openDefaultSection=function(){var b=d.getValue("DefaultSection");switch(b){case"index":a.showIndex=!0;break;case"playlist":a.showPlaylist=!0;break;case"podcast":a.showPodcast=!0}},a.$watch("SelectedAlbumSort.id",function(a,b){if(a!==b)if(g.song.length>0)g.sortSubsonicSongs(a);else if(g.content.album.length>0){g.sortSubsonicAlbums(a);var c=$.map(e.AlbumSorts,function(b,c){return b.id===a?c:void 0});e.settings.DefaultAlbumSort=e.AlbumSorts[c]}}),b.$watch("SelectedMusicFolder",function(b,c){b!==c&&(d.setValue("MusicFolders",angular.toJson(b),!0),a.getArtists(b.id,!0))}),a.SearchType=e.settings.DefaultSearchType,a.SearchTypes=e.SearchTypes,a.playlistsGenre=e.SavedGenres,a.$watch("selectedGenre",function(a,b){a!==b&&(e.SavedGenres.push(a),d.setValue("SavedGenres",e.SavedGenres.join(),!1))}),a.rescanLibrary=function(){$.ajax({url:e.BaseURL()+"/getUser.view?"+e.BaseParams()+"&username="+e.settings.Username,method:"GET",dataType:e.settings.Protocol,timeout:e.settings.Timeout,success:function(a){a["subsonic-response"].user.adminRole===!0?$.get(e.settings.Server+"/musicFolderSettings.view?scanNow&"+e.BaseParams()):alert("You are not logged in as an admin user!")}})},a.selectAll=function(){b.selectAll(a.song)},a.selectNone=function(){b.selectNone(a.song)},a.playAll=function(){b.playAll(a.song)},a.playFrom=function(c){b.playFrom(c,a.song)},a.removeSong=function(c){b.removeSong(c,a.song)},a.songsRemoveSelected=function(){g.songsRemoveSelected(a.selectedSongs).then(function(b){a.album=b.album,a.song=b.song})},a.getArtists=function(b,c){g.getArtists(b,c).then(function(b){a.index=b.artists,a.shortcut=b.shortcuts})},a.refreshArtists=function(){d.setValue("MusicFolders",null,!0),a.getArtists(0,!0),a.getPlaylists(!0)},a.getAlbums=function(b,c){g.getAlbums(b,c).then(function(b){a.album=b.album,a.song=b.song,a.BreadCrumbs=b.breadcrumb,a.selectedAutoAlbum=b.selectedAutoAlbum,a.selectedArtist=b.selectedArtist,a.selectedAlbum=b.selectedAlbum,a.selectedPlaylist=b.selectedPlaylist})},a.getAlbumListBy=function(b,c){g.getAlbumListBy(b,c).then(function(b){a.album=b.album,a.song=b.song,a.BreadCrumbs=b.breadcrumb,a.selectedAutoAlbum=b.selectedAutoAlbum,a.selectedArtist=b.selectedArtist,a.selectedPlaylist=b.selectedPlaylist})},a.getSongs=function(b,c){g.getSongs(b,c).then(function(b){a.album=b.album,a.song=b.song})},a.getArtistByTag=function(b){a.selectedAutoAlbum=null,a.selectedArtist=b;var c=e.BaseURL()+"/getArtist.view?"+e.BaseParams()+"&id="+b;$.ajax({url:c,method:"GET",dataType:e.settings.Protocol,timeout:e.settings.Timeout,success:function(b){var c=[];"undefined"!=typeof b["subsonic-response"].artist?(b["subsonic-response"].artist.album.length>0?c=b["subsonic-response"].artist.album:c[0]=b["subsonic-response"].artist.album,g.content.album=[],g.song=[],angular.forEach(c,function(a){g.content.album.push(f.mapAlbum(a))}),a.$apply()):h.updateMessage("No Albums Returned :(",!0)}})},a.getAlbumByTag=function(b){g.getAlbumByTag(b).then(function(b){a.album=b.album,a.song=b.song,a.BreadCrumbs=b.breadcrumb,a.selectedAutoAlbum=b.selectedAutoAlbum,a.selectedArtist=b.selectedArtist,a.selectedPlaylist=b.selectedPlaylist})},a.search=function(){var b=$("#Search").val(),c=$("#SearchType").val();g.search(b,c).then(function(b){a.album=b.album,a.song=b.song})},a.toggleAZ=function(){a.toggleSubmenu("#submenu_AZIndex","#AZIndex","right",44)},a.getPlaylists=function(b){g.getPlaylists(b).then(function(b){a.playlists=b.playlists,a.playlistsPublic=b.playlistsPublic,a.selectedAutoPlaylist=b.selectedAutoPlaylist,a.selectedPlaylist=b.selectedPlaylist})},a.getPlaylist=function(b,c){g.getPlaylist(b,c).then(function(b){a.album=b.album,a.song=b.song,a.selectedAutoPlaylist=b.selectedAutoPlaylist,a.selectedPlaylist=b.selectedPlaylist})},a.getStarred=function(b,c){g.getStarred(b,c).then(function(b){a.album=b.album,a.song=b.song,a.selectedAutoPlaylist=b.selectedAutoPlaylist,a.selectedPlaylist=b.selectedPlaylist})},a.getRandomStarredSongs=function(c){g.getRandomStarredSongs().then(function(d){for(var e=[],g=0;g<d.length;g++)e.push(f.mapSong(d[g]));"play"===c?(b.queue=[].concat(e),h.updateMessage(e.length+" Song(s) Added to Queue",!0),b.playSong(!1,b.queue[0])):"add"===c?(b.queue=b.queue.concat(e),h.updateMessage(e.length+" Song(s) Added to Queue",!0)):"display"===c&&(a.album=[],a.song=e)}).catch(function(a){var b;b=void 0!==a.subsonicError?a.reason+" "+a.subsonicError.message:void 0!==a.httpError?a.reason+" HTTP error "+a.httpError:a.reason,h.updateMessage(b,!0)})},b.getRandomSongs=function(b,c,d){g.getRandomSongs(b,c,d).then(function(b){a.album=b.album,a.song=b.song,a.selectedAutoPlaylist=b.selectedAutoPlaylist,a.selectedPlaylist=b.selectedPlaylist})},a.newPlaylist=function(b,c){g.newPlaylist(b,c).then(function(){a.getPlaylists(!0)})},a.deletePlaylist=function(){g.deletePlaylist().then(function(){a.getPlaylists(!0)})},a.savePlaylist=function(){var b=a.selectedPlaylist;g.savePlaylist().then(function(){a.getPlaylist(b,""),h.updateMessage("Playlist Updated!",!0)})},a.loadPlaylistsForMenu=function(){$.ajax({url:e.BaseURL()+"/getPlaylists.view?"+e.BaseParams(),method:"GET",dataType:e.settings.Protocol,timeout:e.settings.Timeout,success:function(b){var c=[];a.playlistMenu=[],"undefined"!=typeof b["subsonic-response"].playlists.playlist&&(b["subsonic-response"].playlists.playlist.length>0?c=b["subsonic-response"].playlists.playlist:c[0]=b["subsonic-response"].playlists.playlist,angular.forEach(c,function(b){b.owner==e.settings.Username&&a.playlistMenu.push(f.mapPlaylist(b))}),a.playlistMenu.length>0?(a.$apply(),a.toggleSubmenu("#submenu_AddToPlaylist","#action_AddToPlaylist","left",124)):h.updateMessage("No Playlists :(",!0))}})},a.addToPlaylist=function(b){var c=[];if(0!==a.selectedSongs.length){angular.forEach(a.selectedSongs,function(a){c.push(a.id)});var f=d.parseVersionString(e.settings.ApiVersion),g=d.parseVersionString("1.8.0");d.checkVersion(f,g)&&$.ajax({type:"GET",url:e.BaseURL()+"/updatePlaylist.view?"+e.BaseParams(),dataType:e.settings.Protocol,timeout:e.settings.Timeout,data:{playlistId:b,songIdToAdd:c},success:function(){a.selectedSongs.length=0,h.updateMessage("Playlist Updated!",!0)},traditional:!0})}},a.getGenres=function(){g.getGenres().then(function(b){a.Genres=b})},a.getPodcasts=function(b){g.getPodcasts(b).then(function(b){a.podcasts=b})},a.getPodcast=function(b,c){g.getPodcast(b,c).then(function(b){a.album=b.album,a.song=b.song,a.selectedPodcast=b.selectedPodcast})},a.getMusicFolders=function(){$.ajax({url:e.BaseURL()+"/getMusicFolders.view?"+e.BaseParams(),method:"GET",dataType:e.settings.Protocol,timeout:e.settings.Timeout,success:function(c){if(void 0!==c["subsonic-response"].musicFolders.musicFolder){var e=[];if(c["subsonic-response"].musicFolders.musicFolder.length>0?e=c["subsonic-response"].musicFolders.musicFolder:e[0]=c["subsonic-response"].musicFolders.musicFolder,e.unshift({id:-1,name:"All Folders"}),b.MusicFolders=e,d.getValue("MusicFolders")){var f=angular.fromJson(d.getValue("MusicFolders")),g=0,h="";angular.forEach(b.MusicFolders,function(a){a.id==f.id&&(h=g),g++}),b.SelectedMusicFolder=b.MusicFolders[h]}else b.SelectedMusicFolder=b.MusicFolders[0];a.$apply()}}})},a.dragStart=function(a,b){b.item.data("start",b.item.index())},a.dragEnd=function(b,c){var d=c.item.data("start"),e=c.item.index();a.song.splice(e,0,a.song.splice(d,1)[0])},a.getArtists(),a.getAlbums(),a.getPlaylists(),a.getGenres(),a.getPodcasts(),a.openDefaultSection(),a.getMusicFolders(),c.artistId&&c.albumId?a.getAlbumByTag(c.albumId):c.artistId&&a.getAlbums(c.artistId)}]),angular.module("jamstash.archive.ctrl",["jamstash.archive.service"]).controller("ArchiveCtrl",["$scope","$rootScope","$location","$routeParams","$http","$timeout","utils","globals","model","notifications","player","archive","json",function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";a.settings=h.settings,a.itemType="archive",b.song=[],a.Protocol="jsonp",a.artist=[],a.album=[],a.selectedArtist=null,a.selectedAlbum=null,a.selectedSongs=[],a.SavedCollections=h.SavedCollections,a.AllArtists=[],a.loadedCollection=!1,a.writeSavedCollection=function(){g.setValue("SavedCollections",a.SavedCollections.join(),!1),h.SavedCollections=a.SavedCollections},a.addSavedCollection=function(b){if(-1==a.SavedCollections.indexOf(b)){a.SavedCollections.push(b),a.writeSavedCollection();var c=a.AllArtists.indexOf(b);a.AllArtists.splice(c,1)}},a.deleteSavedCollection=function(b){a.SavedCollections.splice(b,1),a.writeSavedCollection()},a.setupDemoCollections=function(){var b=["YonderMountainStringBand","GreenskyBluegrass"];angular.forEach(b,function(b){-1==a.SavedCollections.indexOf(b)&&a.SavedCollections.push(b)})},a.selectedArchiveAlbumSort=h.settings.DefaultArchiveAlbumSort,a.ArchiveAlbumSort=["addeddate desc","addeddate asc","avg_rating desc","avg_rating asc","createdate desc","createdate asc","date desc","date asc","downloads desc","downloads asc","num_reviews desc","num_reviews asc","publicdate desc","publicdate asc","stars desc","stars asc"],a.$watch("selectedArchiveAlbumSort",function(b){g.getValue("AlbumSort")!=b&&("undefined"!=typeof b?(g.setValue("AlbumSort",b,!0),h.settings.DefaultArchiveAlbumSort=b):g.setValue("AlbumSort",null,!0),a.getAlbums(a.selectedArtist))}),a.getYears=function(a){var b=(new Date).getFullYear(),c=[];for(a=a||1950;b>=a;)c.push(a++);return c},a.Years=a.getYears(),a.filter={Year:"",Source:"",Description:""},a.filterSave=function(){a.selectedArtist&&a.getAlbums(a.selectedArtist,a.filter)},a.getArtists=function(b){var c=$("#Artists").val(),d=$("#Collections option:selected").text();(b||c.length>=3)&&l.getArtists(c,d).then(function(b){a.AllArtists=b.artist,a.loadedCollection=!0})},a.getAlbums=function(b){l.getAlbums(b,a.filter).then(function(b){a.song=b.song,a.album=b.album,a.selectedArtist=b.selectedArtist,a.BreadCrumbs=b.breadcrumb})},a.getSongs=function(b,c){l.getSongs(b,c).then(function(b){a.album=b.album,a.song=b.song,a.selectedAlbum=b.selectedAlbum,a.BreadCrumbs=b.breadcrumb,f(function(){$.fancybox.update()})})},a.scrollToTop=function(){$("#Artists").stop().scrollTo("#auto",400)},a.selectAll=function(){b.selectAll(a.song)},a.selectNone=function(){b.selectNone(a.song)},a.playAll=function(){b.playAll(a.song)},a.playFrom=function(c){b.playFrom(c,a.song)},a.removeSong=function(c){b.removeSong(c,a.song)},a.getAlbums(),d.artist&&(d.album?a.getSongs(d.album):a.getAlbums(d.artist),a.addSavedCollection(d.artist))}]),angular.module("JamStash").controller("QueueCtrl",["$scope","$rootScope","$routeParams","$location","utils","globals",function(a,b,c,d,e,f){"use strict";a.settings=f.settings,a.song=b.queue,a.itemType="pl"}]),angular.module("JamStash").filter("capitalize",function(){return function(a){return a.substring(0,1).toUpperCase()+a.substring(1)}}).filter("musicfolder",function(){return function(a){return a.slice(1,a.length)}}).filter("capitalize",function(){return function(a){return a.substring(0,1).toUpperCase()+a.substring(1)}}),angular.module("JamStash").directive("sortable",function(){return{link:function(a,b){b.sortable({start:a.dragStart,update:a.dragEnd}),b.disableSelection()}}}).directive("fancybox",["$compile",function(a){return{restrict:"A",replace:!1,link:function(b,c){b.fancyboxOpen=function(){var d=angular.element(c.html()),e=a(d);$.fancybox.open(d),e(b)}}}}]).directive("songpreview",["$compile","subsonic",function(a,b){return{restrict:"E",templateUrl:"common/songs.html",replace:!1,scope:{song:"@"},link:function(a,c){b.getSongTemplate(function(b){a.song=b,$.fancybox.open(c)})}}}]).directive("stopEvent",function(){return{restrict:"A",link:function(a,b,c){b.bind(c.stopEvent,function(a){a.stopPropagation()})}}}).directive("ngEnter",function(){return{scope:{onEnter:"&"},link:function(a,b){console.log(a),b.bind("keydown keypress",function(b){13===b.which&&(a.onEnter(),a.$apply())})}}}).directive("ngDownload",["$compile",function(a){return{restrict:"E",scope:{data:"="},link:function(b,c){function d(){return URL.createObjectURL(new Blob([JSON.stringify(b.data)],{type:"application/json"}))}c.append(a('<a class="button" download="backup.json"href="'+d()+'">Download</a>')(b)),b.$watch(b.data,function(){c.children()[0].href=d()})}}}]).directive("stopEvent",function(){return{restrict:"A",link:function(a,b,c){b.bind(c.stopEvent,function(a){a.stopPropagation()})}}}).directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)
}),b.preventDefault())})}}).directive("noScopeRepeat",function(){return{restrict:"AE",templateUrl:"commom/message.html",scope:{items:"=items"},compile:function(a){return a.replaceWith(this.template),function(){return!0}}}}).directive("ngMsgs",function(){return{restrict:"E",transclude:!1,scope:{msgs:"="},template:'<span id="msg_{{$index}}" class="message">{{ item }}</span>',link:function(a,b){a.$watch(a.Messages,function(){var c=$compile(template(a));b.append(c),$(b).parent().fadeIn()})}}});